---
title: "testing-ggplot"
author: "Milla Juntunen"
date: '2022-06-27'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
Luetaan excelistä rivejä. Tulisi kehittää jokin kiva keino, miten saisi muokattua sitä, mistä datasta kuvaajaa piirretään.


```{r}
library("readxl")
library("ggplot2")
library("dplyr")

df <- read_excel("C:\\Projektit\\whole_blood_research\\excel\\Emergencyprocess_PHBT_splines.xlsx", sheet = "yritys")

# Filtering rows (only someof them are useful at the time)

PRCBS_data <- filter(df, products == "O-negative PRBCs" )
PRCBS_and_plasma_data <- filter(df, products == "plasma and/or RBCs" )


print(df)

print(PRCBS_data)
print(PRCBS_and_plasma_data)
#transfusion_data  <- read_excel("C:\\Projektit\\whole_blood_research\\excel\\Emergencyprocess_PHBT_splines.xlsx", range = "yritys!D1:E4")


```
Piirretään pelkästä punasoludatasta kuvaaja, oletuksella että tämä himmeli osaa jutella noiden chunkien välillä. 

```{r}
# Testing whether selecting only two columns helps to overcome a problem with ggplot
#PRCBS <- select(PRCBS_data, time, mortality)
#print(PRCBS)
ggplot(data = PRCBS_data, aes(x = time, y = mortality)) +
  geom_point()

```
Siitä tuli erittäin hieno :D Yritetään sovittaa tähän jokin käyrä

```{r}

linear.model <-lm(mortality ~ time, PRCBS_data)
log.model <-lm(log(mortality) ~ time, PRCBS_data)
#exp.model <-lm(mortality ~ exp(time), PRCBS_data) 
# code above doesn't work due to some singularity in the data (2 same time points is the problem, I guess)

log.model.prbcs <- data.frame(x = PRCBS_data$time,
                           y = exp(fitted(log.model)))

#log.model.prcbs_plasma <- data.frame(x = PRCBS_and_plasma_data$x,
                          # y = exp(fitted(log.model)))



ggplot(PRCBS_data, aes(x = time, y = mortality) ) +
    geom_point() +
    geom_smooth(aes(color="Method or formula not specified"), se=FALSE, linetype = 1) +
    geom_smooth(method="lm", aes(color="Linear Model"), formula= (y ~ x), se=FALSE, linetype = 2) +
    geom_smooth(method="lm", aes(color="2. degree polynome"), formula= (y ~ poly(x,2)), se=FALSE, linetype = 3) +
    geom_smooth(method="lm", aes(color="Exp Model"), formula= (y ~ exp(x)), se=FALSE, linetype = 4) +
    geom_line(data = log.model.prbcs, aes(x, y, color = "Log Model"), size = 1, linetype = 5) + 
    guides(color = guide_legend("Model Type"))

#ggplot(PRCBS_and_plasma_data, aes(x = time, y = mortality)) +
     #geom_point()+
     #geom_smooth(se = FALSE, color = 2)
     #geom_smooth(method = "lm", formula = (y ~ exp(x)), se = FALSE)


```
No siitä ei tosiaan tullut ihan niin hieno :DDDD Ei lainkaan pielessä tai mitään :D KUOLEN
- ei toimi kolmannen asteen polynomille, lakkaa piirtämästä korkeammilla asteilla
Sama yhdistelmälle punasolut+plasma
```{r}
linear.model <-lm(mortality ~ time, PRCBS_and_plasma_data)
log.model <-lm(log(mortality) ~ time, PRCBS_and_plasma_data)
log.model.prbcs <- data.frame(x = PRCBS_and_plasma_data$time,
                           y = exp(fitted(log.model)))

# Trying different curves (lol this is sooo wroong)

ggplot(PRCBS_and_plasma_data, aes(x = time, y = mortality) ) +
    geom_point() +
    geom_smooth(aes(color="Method or formula not specified"), se=FALSE, linetype = 1) +
    geom_smooth(method="lm", aes(color="Linear Model"), formula= (y ~ x), se=FALSE, linetype = 2) +
    geom_smooth(method="lm", aes(color="2. degree polynome"), formula= (y ~ poly(x,2)), se=FALSE, linetype = 3) +
    geom_smooth(method="loess", aes(color="Exp Model"), formula= (y ~ exp(x)), se=FALSE, linetype = 5) +
    geom_line(data = log.model.prbcs, aes(x, y, color = "Log Model"), size = 1, linetype = 6) + 
    guides(color = guide_legend("Model Type"))


```
No ei tullut kaunista tästäkään, kolmannen asteen polynomi on negaa ja laittaa muut lyttyyn, korkeammat ei piirry
Piirretään sama vielä kokoverelle:
```{r}
WB_data <- filter(df, products == "LTOWB" )
print(WB_data)

linear.model <-lm(mortality ~ time, WB_data)
log.model <-lm(log(mortality) ~ time, WB_data)
log.model.WB <- data.frame(x = WB_data$time,
                           y = exp(fitted(log.model)))

ggplot(WB_data, aes(x = time, y = mortality) ) +
    geom_point() +
    geom_smooth(aes(color="Method or formula not specified"), se=FALSE, linetype = 1) +
    geom_smooth(method="lm", aes(color="Linear Model"), formula= (y ~ x), se=FALSE, linetype = 2) +
    geom_smooth(method="lm", aes(color="2. degree polynome"), formula= (y ~ poly(x,2)), se=FALSE, linetype = 3) +
    geom_smooth(method="loess", aes(color="Exp Model"), formula= (y ~ exp(x)), se=FALSE, linetype = 5) +
    geom_line(data = log.model.WB, aes(x, y, color = "Log Model"), size = 1, linetype = 6) + 
    guides(color = guide_legend("Model Type"))

```
Lol ihan kauheaa kuraa. Pitänee kokeilla sitä keskiarvojen ottamista. 
